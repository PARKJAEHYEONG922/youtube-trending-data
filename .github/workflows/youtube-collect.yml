name: YouTube íŠ¸ë Œë”© ë°ì´í„° ìë™ ìˆ˜ì§‘

on:
  # ë§¤ì¼ í•œêµ­ì‹œê°„ ìì • (UTC 15:00 = KST 00:00 ë‹¤ìŒë‚ )
  schedule:
    - cron: '0 15 * * *'

  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (í…ŒìŠ¤íŠ¸ìš©)
  workflow_dispatch:

jobs:
  collect:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ“Š YouTube ë°ì´í„° ìˆ˜ì§‘
        env:
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        run: |
          echo "ğŸš€ YouTube íŠ¸ë Œë”© ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘"
          node scripts/collect-youtube-data.js

      - name: ğŸ’¾ Git ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config user.name "YouTube Data Collector"
          git config user.email "bot@github.com"

          # ë³€ê²½ì‚¬í•­ í™•ì¸
          if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“ ë³€ê²½ì‚¬í•­ ë°œê²¬, ì»¤ë°‹ ì¤€ë¹„ ì¤‘..."

            git add data/

            # í•œêµ­ì‹œê°„ìœ¼ë¡œ ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±
            COMMIT_DATE=$(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M KST')
            git commit -m "ğŸ“Š YouTube ë°ì´í„° ìˆ˜ì§‘: ${COMMIT_DATE}"

            echo "â¬†ï¸ GitHubì— í‘¸ì‹œ ì¤‘..."
            git push

            echo "âœ… ë°ì´í„° ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ!"
          else
            echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ ì—†ìŒ (ì´ë¯¸ ìµœì‹  ë°ì´í„°)"
          fi
